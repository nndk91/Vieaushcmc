<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phiếu Đăng Ký Hội Viên - Hội Hữu Nghị Việt Nam – Úc TP.HCM</title>
    <!-- Chosen Palette: Professional Blue & Gray -->
    <!-- Application Structure Plan: A single-page application presenting the registration form within a responsive, centered card layout. The structure follows a logical data entry flow, starting with personal details, moving to professional and contact information, and concluding with a signature capture. This design is a direct, user-friendly translation of the source document's purpose into an interactive digital format, prioritizing ease of use and a clear call-to-action. -->
    <!-- Visualization & Content Choices: Standard HTML5 form elements (text, date, radio, textarea) are used for data input dues to their universal support and accessibility. For the signature, a <canvas> element is implemented. This is the most effective, library-free method for capturing graphical input like a signature directly in the browser, avoiding SVG for simplicity and broader compatibility. The entire form submission is handled asynchronously by a single JavaScript event listener using the Fetch API, providing immediate user feedback (success/error messages) without a page reload, thus creating a modern, seamless user experience. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 2rem 1rem;
        }
        .form-container {
            background-color: #ffffff;
            padding: 2rem 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            max-width: 650px;
            width: 100%;
            border: 1px solid #e5e7eb;
        }
        input, textarea {
            transition: all 0.2s ease-in-out;
        }
        input:focus, textarea:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }
        label {
            font-size: 0.9rem;
        }
        .submit-button:disabled {
            background-color: #93c5fd;
            cursor: not-allowed;
        }
        .message-box {
            display: none;
            padding: 1rem;
            margin-top: 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            text-align: center;
        }
        .message-box.success {
            background-color: #dcfce7;
            color: #166534;
            border: 1px solid #4ade80;
        }
        .message-box.error {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #f87171;
        }
        #signatureCanvas {
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            background-color: #f9fafb;
            cursor: crosshair;
            touch-action: none;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="form-container">
        <div class="text-center mb-8">
            <h2 class="text-xl md:text-2xl font-bold text-gray-800">
                HỘI HỮU NGHỊ VIỆT NAM – ÚC TP.HỒ CHÍ MINH
            </h2>
            <p class="text-sm text-gray-600 mt-1">
                Friendship Tower, 31 Lê Duẩn, Q.1, ĐT: 38296.238
            </p>
            <div class="border-t border-gray-300 my-4 w-24 mx-auto"></div>
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800">
                PHIẾU ĐĂNG KÝ HỘI VIÊN
            </h2>
            <h3 class="text-lg font-semibold text-gray-600 mt-1">
                HỘI HỮU NGHỊ VIỆT NAM – ÚC TP.HCM
            </h3>
        </div>

        <form id="membershipRegistrationForm">
            <div class="space-y-6">
                <!-- Personal Information -->
                <div>
                    <label for="fullName" class="block mb-1 font-medium text-gray-700">Họ và tên</label>
                    <input type="text" id="fullName" name="fullName" required placeholder="Ví dụ: Nguyễn Văn An" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="dob" class="block mb-1 font-medium text-gray-700">Ngày sinh</label>
                        <input type="date" id="dob" name="dob" required class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block mb-1 font-medium text-gray-700">Giới tính</label>
                        <div class="flex items-center space-x-6 mt-2">
                            <label class="flex items-center">
                                <input type="radio" name="gender" value="Nam" required class="form-radio h-4 w-4 text-blue-600">
                                <span class="ml-2 text-gray-800">Nam</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="gender" value="Nữ" required class="form-radio h-4 w-4 text-blue-600">
                                <span class="ml-2 text-gray-800">Nữ</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Professional Information -->
                <div>
                    <label for="australianExperience" class="block mb-1 font-medium text-gray-700">Học tập/Công tác tại Úc (nếu có)</label>
                    <textarea id="australianExperience" name="australianExperience" rows="3" placeholder="Chuyên ngành, thời gian, địa điểm..." class="w-full px-4 py-2 border border-gray-300 rounded-lg"></textarea>
                    <button type="button" id="suggestExperience" class="mt-2 ml-auto block text-sm font-medium text-blue-600 hover:text-blue-800">
                        ✨ Gợi ý mô tả ✨
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="currentWorkplace" class="block mb-1 font-medium text-gray-700">Nơi làm việc hiện nay</label>
                        <input type="text" id="currentWorkplace" name="currentWorkplace" required placeholder="Tên công ty/tổ chức" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label for="position" class="block mb-1 font-medium text-gray-700">Chức danh</label>
                        <input type="text" id="position" name="position" required placeholder="Ví dụ: Giám đốc, Kỹ sư,..." class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    </div>
                </div>

                <!-- Contact Information -->
                <div>
                    <label for="contactAddress" class="block mb-1 font-medium text-gray-700">Địa chỉ liên hệ</label>
                    <textarea id="contactAddress" name="contactAddress" rows="2" required placeholder="Số nhà, đường, phường/xã, quận/huyện, tỉnh/thành phố" class="w-full px-4 py-2 border border-gray-300 rounded-lg"></textarea>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="mobilePhone" class="block mb-1 font-medium text-gray-700">Điện thoại di động</label>
                        <input type="text" id="mobilePhone" name="mobilePhone" required placeholder="Bắt buộc" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label for="phone" class="block mb-1 font-medium text-gray-700">Điện thoại khác (nếu có)</label>
                        <input type="text" id="phone" name="phone" placeholder="Điện thoại bàn/cơ quan" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    </div>
                </div>

                <div>
                    <label for="email" class="block mb-1 font-medium text-gray-700">Email</label>
                    <input type="email" id="email" name="email" required placeholder="vidu@email.com" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>

                <!-- Signature Pad -->
                <div>
                    <label class="block mb-2 font-medium text-gray-700">Chữ ký</label>
                    <div class="relative w-full">
                        <canvas id="signatureCanvas" class="w-full h-40"></canvas>
                    </div>
                     <div class="flex justify-end mt-2">
                        <button type="button" id="clearSignature" class="text-sm font-medium text-blue-600 hover:text-blue-800">Xóa chữ ký</button>
                    </div>
                    <input type="hidden" id="signatureData" name="signatureData">
                </div>
            </div>

            <div class="mt-8">
                <button type="submit" id="submitButton" class="submit-button w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition duration-300">
                    Hoàn Tất Đăng Ký
                </button>
            </div>
            
            <div id="messageBox" class="message-box"></div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('signatureCanvas');
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;

            function setCanvasSize() {
                const dpr = window.devicePixelRatio || 1;
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width * dpr;
                canvas.height = rect.height * dpr;
                ctx.scale(dpr, dpr);
                ctx.strokeStyle = '#374151';
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
            }

            setCanvasSize();
            window.addEventListener('resize', setCanvasSize);

            const getEventCoords = (e) => {
                const rect = canvas.getBoundingClientRect();
                if (e.touches && e.touches.length > 0) {
                    return {
                        x: e.touches[0].clientX - rect.left,
                        y: e.touches[0].clientY - rect.top
                    };
                }
                return {
                    x: e.clientX - rect.left,
                    y: e.clientY - rect.top
                };
            };
            
            const startDrawing = (e) => {
                isDrawing = true;
                const coords = getEventCoords(e);
                [lastX, lastY] = [coords.x, coords.y];
            };

            const draw = (e) => {
                if (!isDrawing) return;
                e.preventDefault();
                const coords = getEventCoords(e);
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(coords.x, coords.y);
                ctx.stroke();
                [lastX, lastY] = [coords.x, coords.y];
            };
            
            const stopDrawing = () => {
                isDrawing = false;
            };

            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            canvas.addEventListener('touchstart', startDrawing);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDrawing);

            document.getElementById('clearSignature').addEventListener('click', () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                document.getElementById('signatureData').value = '';
            });
            
            const form = document.getElementById('membershipRegistrationForm');
            const submitButton = document.getElementById('submitButton');
            const messageBox = document.getElementById('messageBox');
            const australianExperienceTextarea = document.getElementById('australianExperience');
            const suggestExperienceButton = document.getElementById('suggestExperience');

            const isCanvasBlank = () => {
                const blank = document.createElement('canvas');
                blank.width = canvas.width;
                blank.height = canvas.height;
                return canvas.toDataURL() === blank.toDataURL();
            }

            // LLM Integration for Experience Suggestion
            suggestExperienceButton.addEventListener('click', async () => {
                const currentText = australianExperienceTextarea.value.trim();
                let prompt = "";

                if (currentText) {
                    prompt = `Mô tả kinh nghiệm học tập hoặc công tác tại Úc dựa trên thông tin sau: "${currentText}". Hãy mở rộng hoặc làm cho mô tả này chuyên nghiệp và chi tiết hơn, phù hợp cho hồ sơ đăng ký.`;
                } else {
                    prompt = `Hãy gợi ý một đoạn mô tả kinh nghiệm học tập hoặc công tác tại Úc một cách chuyên nghiệp và chi tiết, phù hợp cho hồ sơ đăng ký hội viên.`;
                }

                suggestExperienceButton.disabled = true;
                suggestExperienceButton.textContent = 'Đang gợi ý...';
                australianExperienceTextarea.disabled = true;

                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = ""; // API key is provided by Canvas runtime

                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const suggestedText = result.candidates[0].content.parts[0].text;
                        australianExperienceTextarea.value = suggestedText;
                    } else {
                        messageBox.className = 'message-box error';
                        messageBox.textContent = 'Không thể tạo gợi ý. Vui lòng thử lại.';
                        messageBox.style.display = 'block';
                    }
                } catch (error) {
                    console.error('Gemini API Error:', error);
                    messageBox.className = 'message-box error';
                    messageBox.textContent = `Lỗi khi gợi ý: ${error.message || error.toString()}.`;
                    messageBox.style.display = 'block';
                } finally {
                    suggestExperienceButton.disabled = false;
                    suggestExperienceButton.textContent = '✨ Gợi ý mô tả ✨';
                    australianExperienceTextarea.disabled = false;
                }
            });


            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                if (!fo
